<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matte Lip Kit - Professional Gallery Demo</title>
  
  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css">
  
  <!-- Theme CSS -->
  <link rel="stylesheet" href="./assets/base.css">
  <link rel="stylesheet" href="./assets/component-product-gallery.css">
  
  <style>
    /* Demo-specific styles */
    :root {
      --color-foreground: 18, 18, 18;
      --color-background: 255, 255, 255;
      --color-accent: 233, 30, 99;
      --color-button: 18, 18, 18;
      --color-button-text: 255, 255, 255;
      --page-width: 120rem;
      --font-body-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --font-heading-family: var(--font-body-family);
      --font-body-style: normal;
      --font-body-weight: 400;
      --font-heading-style: normal;
      --font-heading-weight: 600;
    }
    
    body {
      margin: 0;
      padding: 2rem;
      background-color: #f8f9fa;
    }
    
    .demo-container {
      max-width: 120rem;
      margin: 0 auto;
      background: white;
      padding: 4rem;
      border-radius: 1rem;
      box-shadow: 0 0.4rem 2rem rgba(0, 0, 0, 0.1);
    }
    
    .demo-header {
      text-align: center;
      margin-bottom: 4rem;
    }
    
    .demo-title {
      font-size: 3rem;
      color: rgb(var(--color-foreground));
      margin-bottom: 1rem;
    }
    
    .demo-subtitle {
      font-size: 1.6rem;
      color: rgba(var(--color-foreground), 0.7);
      margin-bottom: 2rem;
    }
    
    .demo-badge {
      display: inline-block;
      padding: 0.5rem 1rem;
      background-color: rgb(var(--color-accent));
      color: white;
      border-radius: 2rem;
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    /* Smooth color switching */
    .swiper-slide {
      transition: opacity 0.3s ease;
    }
    
    .color-option {
      transition: all 0.2s ease;
      cursor: pointer;
      opacity: 0.9;
    }
    
    .color-option:hover {
      opacity: 1;
      box-shadow: 0 0 0 1px rgba(var(--color-accent), 0.3);
    }
    
    .color-option--active {
      opacity: 1;
      box-shadow: 0 0 0 2px rgb(var(--color-accent));
    }
    
    /* Optimized loading */
    .lazy-load {
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .lazy-load.loaded {
      opacity: 1;
    }
    
    .loading-placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #f8f9fa;
      color: #666;
      font-size: 1.4rem;
      opacity: 1;
      transition: opacity 0.3s ease;
    }
    
    .loading-placeholder.hidden {
      opacity: 0;
      pointer-events: none;
    }
    
    .product-media {
      position: relative;
      overflow: hidden;
    }
    
    /* Color switcher styles */
    .color-switcher__options {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .color-option {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      border: 2px solid transparent;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }
    
    .color-option__swatch {
      width: 32px;
      height: 32px;
      border-radius: 0.25rem;
      border: 2px solid rgba(0, 0, 0, 0.1);
      flex-shrink: 0;
    }
    
    .color-swatch--wet-stone {
      background: linear-gradient(135deg, #8B7D6B 0%, #A5978A 100%);
    }
    
    .color-swatch--seaweed-glow {
      background: linear-gradient(135deg, #2E8B57 0%, #3CB371 100%);
    }
    
    .color-swatch--coral-blush {
      background: linear-gradient(135deg, #FF6B6B 0%, #FF8E8E 100%);
    }
    
    .color-option__label {
      font-size: 1.4rem;
      font-weight: 500;
      white-space: nowrap;
    }
    
    .color-option:hover {
      border-color: rgba(0, 0, 0, 0.2);
      background: rgba(0, 0, 0, 0.02);
    }
    
    .color-option.active {
      border-color: #007bff;
      background: rgba(0, 123, 255, 0.05);
    }
    
    .color-option.active .color-option__swatch {
      border-color: #007bff;
      transform: scale(1.05);
    }
    
    .color-option:hover .color-option__swatch {
      transform: scale(1.02);
    }
    
    /* Custom navigation arrows - laconic style */
    .swiper-button-next,
    .swiper-button-prev {
      width: 40px !important;
      height: 40px !important;
      background: rgba(255, 255, 255, 0.85) !important;
      border-radius: 50% !important;
      color: rgba(var(--color-foreground), 0.8) !important;
      border: 1px solid rgba(0, 0, 0, 0.08) !important;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1) !important;
      transition: all 0.25s ease !important;
      margin-top: -20px !important;
      z-index: 10 !important;
      opacity: 0.8 !important;
    }
    
    .swiper-button-next:after,
    .swiper-button-prev:after {
      font-size: 14px !important;
      font-weight: 600 !important;
    }
    
    .swiper-button-next:hover,
    .swiper-button-prev:hover {
      background: rgba(255, 255, 255, 0.98) !important;
      color: rgb(var(--color-accent)) !important;
      opacity: 1 !important;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15) !important;
    }
    
    .swiper-button-prev {
      left: 15px !important;
    }
    
    .swiper-button-next {
      right: 15px !important;
    }
    
    /* Hide navigation on small screens */
    @media (max-width: 749px) {
      .swiper-button-next,
      .swiper-button-prev {
        display: none !important;
      }
    }
    
    /* Enhanced pagination - laconic style */
    .swiper-pagination {
      bottom: 15px !important;
    }
    
    .swiper-pagination-bullet {
      background: rgba(255, 255, 255, 0.6) !important;
      border: 1px solid rgba(0, 0, 0, 0.15) !important;
      opacity: 0.7 !important;
      transition: all 0.2s ease !important;
    }
    
    .swiper-pagination-bullet:hover {
      opacity: 0.9 !important;
      background: rgba(255, 255, 255, 0.8) !important;
    }
    
    .swiper-pagination-bullet-active {
      background: rgb(var(--color-accent)) !important;
      border-color: rgb(var(--color-accent)) !important;
      opacity: 1 !important;
    }
  </style>
</head>
<body>
  <div class="demo-container">
    <div class="demo-header">
      <h1 class="demo-title">Matte Lip Kit - Professional Gallery</h1>
      <p class="demo-subtitle">Interactive product gallery with instant color variant filtering</p>
      <span class="demo-badge">Professional Demo</span>
    </div>

    <!-- Product Layout -->
    <div class="product-main">
      <div class="product-main__container">
        <div class="grid grid--2-col-tablet product-main__grid">
          
          <!-- Product Gallery -->
          <div class="grid__item product-main__media">
            <div class="product-gallery" 
                 data-product-gallery 
                 data-product-handle="mette-lip-kit">
              
              <!-- Swiper Container -->
              <div class="swiper gallery-swiper"
                   data-swiper-config='{
                     "slidesPerView": {
                       "mobile": 1,
                       "tablet": 1,
                       "desktop": 1
                     },
                     "pagination": {
                       "mobile": true,
                       "tablet": true,
                       "desktop": true
                     },
                     "navigation": {
                       "mobile": false,
                       "tablet": true,
                       "desktop": true
                     },
                     "spaceBetween": {
                       "mobile": 10,
                       "tablet": 15,
                       "desktop": 20
                     }
                   }'
                   data-media-count="12">
                
                <div class="swiper-wrapper">
                  <!-- Wet Stone Images (4 slides) - Load immediately -->
                  <div class="swiper-slide" data-color="wet-stone" data-media-type="image">
                    <div class="product-media product-media--image">
                      <img src="./demo-images/wet-stone-1.svg" alt="Mette Lip Kit - Wet Stone View 1" loading="eager" width="600" height="600">
                    </div>
                  </div>
                  <div class="swiper-slide" data-color="wet-stone" data-media-type="image">
                    <div class="product-media product-media--image">
                      <img src="./demo-images/wet-stone-2.svg" alt="Mette Lip Kit - Wet Stone View 2" loading="eager" width="600" height="600">
                    </div>
                  </div>
                  <div class="swiper-slide" data-color="wet-stone" data-media-type="image">
                    <div class="product-media product-media--image">
                      <img src="./demo-images/wet-stone-3.svg" alt="Mette Lip Kit - Wet Stone View 3" loading="lazy" width="600" height="600">
                    </div>
                  </div>
                  <div class="swiper-slide" data-color="wet-stone" data-media-type="image">
                    <div class="product-media product-media--image">
                      <img src="./demo-images/wet-stone-4.svg" alt="Mette Lip Kit - Wet Stone View 4" loading="lazy" width="600" height="600">
                    </div>
                  </div>

                  <!-- Seaweed Glow Images (4 slides) - Load on demand -->
                  <div class="swiper-slide" data-color="seaweed-glow" data-media-type="image">
                    <div class="product-media product-media--image">
                      <img data-src="./demo-images/seaweed-glow-1.svg" alt="Mette Lip Kit - Seaweed Glow View 1" width="600" height="600" class="lazy-load">
                      <div class="loading-placeholder">Loading...</div>
                    </div>
                  </div>
                  <div class="swiper-slide" data-color="seaweed-glow" data-media-type="image">
                    <div class="product-media product-media--image">
                      <img data-src="./demo-images/seaweed-glow-2.svg" alt="Mette Lip Kit - Seaweed Glow View 2" width="600" height="600" class="lazy-load">
                      <div class="loading-placeholder">Loading...</div>
                    </div>
                  </div>
                  <div class="swiper-slide" data-color="seaweed-glow" data-media-type="image">
                    <div class="product-media product-media--image">
                      <img data-src="./demo-images/seaweed-glow-3.svg" alt="Mette Lip Kit - Seaweed Glow View 3" width="600" height="600" class="lazy-load">
                      <div class="loading-placeholder">Loading...</div>
                    </div>
                  </div>
                  <div class="swiper-slide" data-color="seaweed-glow" data-media-type="image">
                    <div class="product-media product-media--image">
                      <img data-src="./demo-images/seaweed-glow-4.svg" alt="Mette Lip Kit - Seaweed Glow View 4" width="600" height="600" class="lazy-load">
                      <div class="loading-placeholder">Loading...</div>
                    </div>
                  </div>

                  <!-- Coral Blush Images (4 slides) - Load on demand -->
                  <div class="swiper-slide" data-color="coral-blush" data-media-type="image">
                    <div class="product-media product-media--image">
                      <img data-src="./demo-images/coral-blush-1.svg" alt="Mette Lip Kit - Coral Blush View 1" width="600" height="600" class="lazy-load">
                      <div class="loading-placeholder">Loading...</div>
                    </div>
                  </div>
                  <div class="swiper-slide" data-color="coral-blush" data-media-type="image">
                    <div class="product-media product-media--image">
                      <img data-src="./demo-images/coral-blush-2.svg" alt="Mette Lip Kit - Coral Blush View 2" width="600" height="600" class="lazy-load">
                      <div class="loading-placeholder">Loading...</div>
                    </div>
                  </div>
                  <div class="swiper-slide" data-color="coral-blush" data-media-type="image">
                    <div class="product-media product-media--image">
                      <img data-src="./demo-images/coral-blush-3.svg" alt="Mette Lip Kit - Coral Blush View 3" width="600" height="600" class="lazy-load">
                      <div class="loading-placeholder">Loading...</div>
                    </div>
                  </div>
                  <div class="swiper-slide" data-color="coral-blush" data-media-type="image">
                    <div class="product-media product-media--image">
                      <img data-src="./demo-images/coral-blush-4.svg" alt="Mette Lip Kit - Coral Blush View 4" width="600" height="600" class="lazy-load">
                      <div class="loading-placeholder">Loading...</div>
                    </div>
                  </div>
                </div>

                <!-- Pagination -->
                <div class="swiper-pagination"></div>

                <!-- Navigation -->
                <button class="swiper-button-next" aria-label="Next image">
                  <span class="visually-hidden">Next</span>
                </button>
                <button class="swiper-button-prev" aria-label="Previous image">
                  <span class="visually-hidden">Previous</span>
                </button>
              </div>

              <!-- Status for accessibility -->
              <div class="visually-hidden" aria-live="polite" role="status">
                <span data-gallery-status>Gallery loaded with 12 images</span>
              </div>
            </div>
          </div>

          <!-- Product Info -->
          <div class="grid__item product-main__info">
            <div class="product-info">
              <h1 class="product-info__title h1">Matte Lip Kit</h1>
              
              <div class="product-info__price">
                <span class="price price--large">
                  <span class="price__container">
                    <div class="price__regular">
                      <span class="price-item price-item--regular">$24.99 USD</span>
                    </div>
                  </span>
                </span>
              </div>

              <!-- Color Switcher -->
              <fieldset class="product-form__input color-switcher" data-color-selector>
                <legend class="form__label color-switcher__label">
                  <span>Color:</span>
                  <span class="color-switcher__selected" data-selected-color>Wet Stone</span>
                </legend>

                <div class="color-switcher__options">
                  <div class="color-option-wrapper">
                    <input type="radio" id="color-wet-stone" name="product-color" value="Wet Stone" checked class="color-option__input visually-hidden">
                    <label for="color-wet-stone" 
                           class="color-option color-option--active"
                           data-color="wet-stone"
                           data-color-value="Wet Stone">
                      <span class="color-option__swatch color-swatch--wet-stone"></span>
                      <span class="color-option__label">Wet Stone</span>
                    </label>
                  </div>

                  <div class="color-option-wrapper">
                    <input type="radio" id="color-seaweed-glow" name="product-color" value="Seaweed Glow" class="color-option__input visually-hidden">
                    <label for="color-seaweed-glow" 
                           class="color-option"
                           data-color="seaweed-glow"
                           data-color-value="Seaweed Glow">
                      <span class="color-option__swatch color-swatch--seaweed-glow"></span>
                      <span class="color-option__label">Seaweed Glow</span>
                    </label>
                  </div>

                  <div class="color-option-wrapper">
                    <input type="radio" id="color-coral-blush" name="product-color" value="Coral Blush" class="color-option__input visually-hidden">
                    <label for="color-coral-blush" 
                           class="color-option"
                           data-color="coral-blush"
                           data-color-value="Coral Blush">
                      <span class="color-option__swatch color-swatch--coral-blush"></span>
                      <span class="color-option__label">Coral Blush</span>
                    </label>
                  </div>
                </div>

                <div class="color-switcher__message" aria-live="polite" role="status">
                  <span class="visually-hidden" data-color-availability-message></span>
                </div>
              </fieldset>

              <!-- Add to Cart -->
              <button type="button" class="button product-form__cart-submit" style="margin: 2rem 0;">
                <span>Add to Cart</span>
              </button>

              <!-- Product Description -->
              <div class="product-info__description rte">
                <p>Premium matte lip kit with long-lasting, full-coverage color and comfortable finish.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JSON Data for JavaScript -->
  <script type="application/json" id="ProductImagesData-demo">
    {
      "wet-stone": [
        {
          "id": 1,
          "media_type": "image",
          "alt": "Mette Lip Kit - Wet Stone View 1",
          "src": "./demo-images/wet-stone-1.svg",
          "width": 600,
          "height": 600
        },
        {
          "id": 2,
          "media_type": "image",
          "alt": "Mette Lip Kit - Wet Stone View 2",
          "src": "./demo-images/wet-stone-2.svg",
          "width": 600,
          "height": 600
        },
        {
          "id": 3,
          "media_type": "image",
          "alt": "Mette Lip Kit - Wet Stone View 3",
          "src": "./demo-images/wet-stone-3.svg",
          "width": 600,
          "height": 600
        },
        {
          "id": 4,
          "media_type": "image",
          "alt": "Mette Lip Kit - Wet Stone View 4",
          "src": "./demo-images/wet-stone-4.svg",
          "width": 600,
          "height": 600
        }
      ],
      "seaweed-glow": [
        {
          "id": 5,
          "media_type": "image",
          "alt": "Mette Lip Kit - Seaweed Glow View 1",
          "src": "./demo-images/seaweed-glow-1.svg",
          "width": 600,
          "height": 600
        },
        {
          "id": 6,
          "media_type": "image",
          "alt": "Mette Lip Kit - Seaweed Glow View 2",
          "src": "./demo-images/seaweed-glow-2.svg",
          "width": 600,
          "height": 600
        },
        {
          "id": 7,
          "media_type": "image",
          "alt": "Mette Lip Kit - Seaweed Glow View 3",
          "src": "./demo-images/seaweed-glow-3.svg",
          "width": 600,
          "height": 600
        },
        {
          "id": 8,
          "media_type": "image",
          "alt": "Mette Lip Kit - Seaweed Glow View 4",
          "src": "./demo-images/seaweed-glow-4.svg",
          "width": 600,
          "height": 600
        }
      ],
      "coral-blush": [
        {
          "id": 9,
          "media_type": "image",
          "alt": "Mette Lip Kit - Coral Blush View 1",
          "src": "./demo-images/coral-blush-1.svg",
          "width": 600,
          "height": 600
        },
        {
          "id": 10,
          "media_type": "image",
          "alt": "Mette Lip Kit - Coral Blush View 2",
          "src": "./demo-images/coral-blush-2.svg",
          "width": 600,
          "height": 600
        },
        {
          "id": 11,
          "media_type": "image",
          "alt": "Mette Lip Kit - Coral Blush View 3",
          "src": "./demo-images/coral-blush-3.svg",
          "width": 600,
          "height": 600
        },
        {
          "id": 12,
          "media_type": "image",
          "alt": "Mette Lip Kit - Coral Blush View 4",
          "src": "./demo-images/coral-blush-4.svg",
          "width": 600,
          "height": 600
        }
      ]
    }
  </script>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
  
  <!-- Product Gallery JS -->
  <script src="./assets/product-gallery.js"></script>
  
  <!-- Demo-specific JavaScript -->
  <script>
    // Initialize gallery for demo
    document.addEventListener('DOMContentLoaded', function() {
      // Update gallery container for demo
      const gallery = document.querySelector('[data-product-gallery]');
      if (gallery) {
        gallery.dataset.productGallery = 'demo';
      }

      // Add demo interactivity for cart button
      const addToCartBtn = document.querySelector('.product-form__cart-submit');
      if (addToCartBtn) {
        addToCartBtn.addEventListener('click', function(e) {
          e.preventDefault();
          alert('Demo: In real Shopify store this would add the product to cart');
        });
      }

      // Wait for Swiper to initialize, then setup color switching
      setTimeout(() => {
        setupColorSwitching();
      }, 500);
    });

    // Clean color switching function
    function setupColorSwitching() {
      const colorOptions = document.querySelectorAll('.color-option');
      let currentColor = 'wet-stone';
      
      // Wait for slides to be available
      function waitForSlides(callback) {
        const checkSlides = () => {
          const slides = document.querySelectorAll('.swiper-slide');
          if (slides.length > 0) {
            callback();
          } else {
            setTimeout(checkSlides, 100);
          }
        };
        checkSlides();
      }
      
      // Hide all slides initially except the first color
      function initializeSlides() {
        const allSlides = document.querySelectorAll('.swiper-slide');
        
        allSlides.forEach(slide => {
          if (slide.dataset.color !== currentColor) {
            slide.style.display = 'none';
          } else {
            slide.style.display = 'block';
          }
        });
        
        // Ensure first color is active
        updateActiveOption(currentColor);
      }
      
      // Load images for specific color
      function loadImagesForColor(color) {
        const colorSlides = document.querySelectorAll(`[data-color="${color}"]`);
        
        colorSlides.forEach(slide => {
          const img = slide.querySelector('.lazy-load');
          const placeholder = slide.querySelector('.loading-placeholder');
          
          if (img && img.dataset.src && !img.src) {
            img.src = img.dataset.src;
            
            img.onload = () => {
              img.classList.add('loaded');
              if (placeholder) {
                placeholder.classList.add('hidden');
              }
            };
            
            img.onerror = () => {
              if (placeholder) {
                placeholder.textContent = 'Failed to load';
                placeholder.style.color = '#dc3545';
              }
            };
          }
        });
      }

      function filterByColor(color) {
        const allSlides = document.querySelectorAll('.swiper-slide');
        let visibleCount = 0;
        
        // Load images for the selected color first
        loadImagesForColor(color);
        
        allSlides.forEach(slide => {
          if (slide.dataset.color === color) {
            slide.style.display = 'block';
            slide.style.opacity = '1';
            visibleCount++;
          } else {
            slide.style.display = 'none';
            slide.style.opacity = '0';
          }
        });
        
        // Update Swiper immediately and after a short delay
        if (window.swiperInstance) {
          window.swiperInstance.update();
          window.swiperInstance.slideTo(0, 0); // Go to first slide immediately
          
          setTimeout(() => {
            window.swiperInstance.update();
            // Update navigation state
            updateNavigationVisibility(visibleCount);
          }, 50);
        }
        
        return visibleCount;
      }
      
      // Update navigation visibility based on slide count
      function updateNavigationVisibility(slideCount) {
        const nextBtn = document.querySelector('.swiper-button-next');
        const prevBtn = document.querySelector('.swiper-button-prev');
        const pagination = document.querySelector('.swiper-pagination');
        
        if (slideCount <= 1) {
          // Hide navigation if only one slide
          if (nextBtn) nextBtn.style.opacity = '0';
          if (prevBtn) prevBtn.style.opacity = '0';
          if (pagination) pagination.style.opacity = '0';
        } else {
          // Show navigation if multiple slides
          if (nextBtn) nextBtn.style.opacity = '1';
          if (prevBtn) prevBtn.style.opacity = '1';
          if (pagination) pagination.style.opacity = '1';
        }
      }

      function updateActiveOption(color) {
        colorOptions.forEach(option => {
          if (option.dataset.color === color) {
            option.classList.add('color-option--active');
            const input = option.closest('.color-option-wrapper')?.querySelector('input');
            if (input) input.checked = true;
          } else {
            option.classList.remove('color-option--active');
          }
        });
        
        // Update selected color text
        const selectedSpan = document.querySelector('[data-selected-color]');
        if (selectedSpan) {
          const colorValue = document.querySelector(`[data-color="${color}"]`)?.dataset.colorValue;
          if (colorValue) selectedSpan.textContent = colorValue;
        }
      }
      
      // Initialize slides first
      initializeSlides();
      
      // Setup event listeners for color switching
      colorOptions.forEach(option => {
        const wrapper = option.closest('.color-option-wrapper');
        const input = wrapper?.querySelector('input[type="radio"]');
        
        // Input change event
        if (input) {
          input.addEventListener('change', (e) => {
            if (e.target.checked) {
              const newColor = option.dataset.color;
              if (newColor !== currentColor) {
                currentColor = newColor;
                updateActiveOption(newColor);
                filterByColor(newColor);
              }
            }
          });
        }
        
        // Label click event - immediate response
        option.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          
          const newColor = option.dataset.color;
          if (newColor !== currentColor) {
            currentColor = newColor;
            
            // Update immediately
            updateActiveOption(newColor);
            filterByColor(newColor);
            
            // Preload next color
            preloadNextColor(newColor);
            
            // Update input
            if (input && !input.checked) {
              input.checked = true;
            }
          }
        });
        
        // Also handle input clicks directly
        if (input) {
          input.addEventListener('click', (e) => {
            const newColor = option.dataset.color;
            if (newColor !== currentColor) {
              currentColor = newColor;
              updateActiveOption(newColor);
              filterByColor(newColor);
              preloadNextColor(newColor);
            }
          });
        }
      });
      
      // Preload next color images in background
      function preloadNextColor(currentColor) {
        const colors = ['wet-stone', 'seaweed-glow', 'coral-blush'];
        const currentIndex = colors.indexOf(currentColor);
        const nextIndex = (currentIndex + 1) % colors.length;
        const nextColor = colors[nextIndex];
        
        // Load next color images with lower priority
        setTimeout(() => {
          loadImagesForColor(nextColor);
        }, 1000);
      }

      // Keyboard navigation for gallery
      document.addEventListener('keydown', (e) => {
        if (!window.swiperInstance) return;
        
        switch(e.key) {
          case 'ArrowLeft':
            e.preventDefault();
            window.swiperInstance.slidePrev();
            break;
          case 'ArrowRight':
            e.preventDefault();
            window.swiperInstance.slideNext();
            break;
        }
      });

      // Initialize when slides are ready
      waitForSlides(() => {
        initializeSlides();
        updateActiveOption(currentColor);
        filterByColor(currentColor);
        
        // Preload next color after initial load
        preloadNextColor(currentColor);
      });
    }
  </script>
</body>
</html>